name: Run tests
on: push

jobs:
  test:
    # Containers must run in Linux based operating systems
    runs-on: ubuntu-latest

    # Service containers to run - tests require CoreNLP
    services:
      corenlp:
        image: docker.pkg.github.com/britishgeologicalsurvey/geo-ner-model/corenlp:v0.3
        credentials:
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GITHUB_TOKEN }}
        ports:
          - 9000:9000

    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: run the unit tests
        run: |
          pip3 install setuptools>=42.0.0 wheel
          pip3 install -r requirements.txt
          pip3 install pytest flake8
          export PYTHONPATH=.:..
          flake8 stratigraph tests scripts
          python3 -m pytest -vs tests
